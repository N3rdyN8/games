l<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Poker Table</title>

<style>
body {
  background: #0b6623;
  font-family: system-ui, sans-serif;
  color: white;
  padding: 10px;
}
h1 { text-align: center; }

#street { text-align: center; font-size: 20px; }
#pot {
  background: gold;
  color: black;
  text-align: center;
  font-size: 22px;
  padding: 10px;
  border-radius: 10px;
  margin: 10px 0;
}

.player {
  background: white;
  color: black;
  padding: 10px;
  border-radius: 8px;
  margin-bottom: 8px;
}
.active { border: 3px solid #2196f3; }
.folded { opacity: 0.4; text-decoration: line-through; }

.badge {
  background: black;
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 12px;
  margin-left: 4px;
}

.row { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 6px; }

button {
  padding: 6px 10px;
  border: none;
  border-radius: 5px;
}
.check { background: gray; color: white; }
.raise { background: orange; color: white; }
.fold { background: red; color: white; }

.add, .award, .next, .reset {
  width: 100%;
  margin-top: 6px;
  background: black;
  color: white;
}

.profit { text-align: center; margin-top: 10px; }
.positive { color: lightgreen; }
.negative { color: #ff5252; }
</style>
</head>

<body>

<h1>Poker Table</h1>

<button class="add" onclick="addPlayer()">Add Player</button>
<button class="reset" onclick="resetSession()">Reset Session</button>

<div id="street">Pre-Flop</div>
<div id="pot">Pot: $0</div>

<div id="players"></div>

<button class="award" onclick="awardPot()">Award Pot</button>
<button class="next" onclick="nextHand()">Next Hand</button>

<div id="profit" class="profit"></div>

<script>
let players = [];
let pot = 0;
let current = 0;
let highestBet = 0;
let dealer = 0;

const streets = ["Pre-Flop", "Flop", "Turn", "River"];
let streetIndex = 0;

const SB = 5;
const BB = 10;

function addPlayer() {
  const name = prompt("Player name:");
  if (!name) return;

  const buyIn = +prompt("Buy-in amount:");
  if (!buyIn) return;

  players.push({
    name,
    stack: buyIn,
    buyIn,
    bet: 0,
    folded: false,
    acted: false,
    allIn: false
  });

  if (players.length === 2) startHand();
  render();
}

function startHand() {
  pot = 0;
  streetIndex = 0;
  highestBet = 0;

  players.forEach(p => {
    p.bet = 0;
    p.folded = false;
    p.acted = false;
    p.allIn = false;
  });

  postBlinds();
}

function smallBlind() { return (dealer + 1) % players.length; }
function bigBlind() { return (dealer + 2) % players.length; }

function postBlinds() {
  postBlind(smallBlind(), SB);
  postBlind(bigBlind(), BB);
  highestBet = BB;
  current = (dealer + 3) % players.length;
}

function postBlind(i, amt) {
  const p = players[i];
  const blind = Math.min(amt, p.stack);
  p.stack -= blind;
  p.bet += blind;
  pot += blind;
  if (p.stack === 0) p.allIn = true;
}

function checkCall(i) {
  if (i !== current) return;
  const p = players[i];

  const needed = highestBet - p.bet;
  const call = Math.min(needed, p.stack);

  p.stack -= call;
  p.bet += call;
  pot += call;
  if (p.stack === 0) p.allIn = true;

  p.acted = true;
  nextTurn();
}

function raiseBet(i) {
  if (i !== current) return;
  const p = players[i];

  let target = +prompt("Raise TO:");
  if (!target || target <= highestBet) return;

  const max = p.bet + p.stack;
  if (target > max) target = max;

  const diff = target - p.bet;
  p.stack -= diff;
  p.bet = target;
  pot += diff;
  highestBet = target;

  if (p.stack === 0) p.allIn = true;

  players.forEach(pl => pl.acted = false);
  p.acted = true;
  nextTurn();
}

function fold(i) {
  if (i !== current) return;
  players[i].folded = true;
  players[i].acted = true;
  nextTurn();
}

function nextTurn() {
  if (bettingComplete()) {
    advanceStreet();
    return;
  }
  do {
    current = (current + 1) % players.length;
  } while (players[current].folded || players[current].allIn);
  render();
}

function bettingComplete() {
  return players.every(p =>
    p.folded || p.allIn || (p.acted && p.bet === highestBet)
  );
}

function advanceStreet() {
  if (streetIndex < 3) {
    streetIndex++;
    resetBets();
  }
  render();
}

function resetBets() {
  highestBet = 0;
  players.forEach(p => {
    p.bet = 0;
    p.acted = false;
  });
  current = firstActive();
}

function firstActive() {
  for (let i = 0; i < players.length; i++)
    if (!players[i].folded && !players[i].allIn) return i;
  return 0;
}

function awardPot() {
  if (!pot) return;
  const names = players.filter(p => !p.folded).map(p => p.name).join("\n");
  const winner = prompt("Winner:\n" + names);
  const p = players.find(x => x.name === winner);
  if (!p) return;

  p.stack += pot;
  pot = 0;
  nextHand();
}

function nextHand() {
  dealer = (dealer + 1) % players.length;
  startHand();
  render();
}

function resetSession() {
  if (!confirm("Reset entire session?")) return;
  players = [];
  pot = 0;
  dealer = 0;
  current = 0;
  highestBet = 0;
  streetIndex = 0;
  document.getElementById("players").innerHTML = "";
  document.getElementById("profit").innerHTML = "";
  render();
}

function render() {
  document.getElementById("street").textContent = streets[streetIndex];
  document.getElementById("pot").textContent = "Pot: $" + pot;

  const div = document.getElementById("players");
  div.innerHTML = "";

  players.forEach((p, i) => {
    let tags = "";
    if (i === dealer) tags += " <span class='badge'>D</span>";
    if (i === smallBlind()) tags += " <span class='badge'>SB</span>";
    if (i === bigBlind()) tags += " <span class='badge'>BB</span>";
    if (p.allIn) tags += " <span class='badge'>ALL-IN</span>";

    div.innerHTML += `
      <div class="player ${i===current?'active':''} ${p.folded?'folded':''}">
        <b>${p.name}</b>${tags}<br>
        Stack: $${p.stack} | Bet: $${p.bet}
        <div class="row">
          <button class="check" onclick="checkCall(${i})">Check/Call</button>
          <button class="raise" onclick="raiseBet(${i})">Raise</button>
          <button class="fold" onclick="fold(${i})">Fold</button>
        </div>
      </div>`;
  });

  renderProfit();
}

function renderProfit() {
  let html = "<h3>Session Profit</h3>";
  players.forEach(p => {
    const profit = p.stack - p.buyIn;
    html += `<div class="${profit>=0?'positive':'negative'}">
      ${p.name}: ${profit>=0?'+':''}$${profit}
    </div>`;
  });
  document.getElementById("profit").innerHTML = html;
}

render();
</script>

</body>
</html>
